# Бэклог: RetailCRM — Анализ работы менеджеров

> Связано: [ТЗ](ТЗ_выгрузка_чатов_RetailCRM.md) | [Архитектура](Архитектура.md) | 

---

## Статусы задач
- `todo` — не начато
- `in_progress` — в работе
- `done` — завершено
- `on_hold` — приостановлено

---

## Фаза 1: MVP — Базовая выгрузка и анализ

### P1 — Выгрузка данных из RetailCRM
- [P1][done] Клиент API RetailCRM: [retailcrm_client.py](retailcrm_client.py)
- [P1][done] Скрипт полной выгрузки: [complete_export.py](complete_export.py)
- [P1][done] Экспорт в Google Sheets: [export_to_sheets.py](export_to_sheets.py)
- [P1][done] Батч-экспорт (большие объёмы): [export_to_sheets_batch.py](export_to_sheets_batch.py)
- [P1][done] Проверка данных: [check_data.py](check_data.py)

### P1 — Google Sheets структура
- [P1][done] Лист `chats_raw` (сырые данные чатов)
- [P1][done] Лист `messages_raw` (сырые данные сообщений)
- [P1][done] Лист `manager_summary` (сводка по менеджерам)
- [P1][done] Лист `channel_summary` (сводка по каналам)
- [P1][done] Лист `chat_advice` (советы по чатам)

### P2 — Базовая аналитика
- [P2][done] Правила анализа: [analysis_rules.py](analysis_rules.py)
- [P2][done] Шаблоны диалогов: [dialog_templates.py](dialog_templates.py)
- [P2][done] Анализ типов вопросов: [question_type_analysis.py](question_type_analysis.py)
- [P2][done] Анализ качества чатов: [quality_chats_analysis.py](quality_chats_analysis.py)

---

## Фаза 2: SPIN-анализ (методика Нила Рэкхема)

### P1 — Реализация SPIN
- [P1][done] Основной скрипт SPIN-анализа: [spin_analysis.py](spin_analysis.py)
- [P1][done] Лист `spin_manager_metrics` (SPIN по менеджерам)
- [P1][done] Лист `spin_chat_metrics` (SPIN по чатам)
- [P1][done] Лист `spin_improvement_plans` (планы улучшения)
- [P1][done] Документ: [План_улучшения_SPIN.md](План_улучшения_SPIN.md)

### P2 — Расширенный SPIN-анализ
- [P2][done] Анализ конверсии SPIN: [spin_conversion_analysis.py](spin_conversion_analysis.py)
- [P2][todo] Корреляция SPIN ↔ конверсия в заказ
- [P2][todo] Топ-10 best practices из чатов с полным SPIN

### P3 — AI-анализ (будущее)
- [P3][on_hold] Автоматическая классификация SPIN через Claude/OpenAI
- [P3][on_hold] Генерация персонализированных планов улучшения
- [P3][on_hold] Анализ тональности сообщений

---

## Фаза 3: Отчёты и уведомления

### P1 — Ежедневные отчёты
- [P1][done] Ежедневный отчёт: [daily_report.py](daily_report.py)
- [P1][done] Отчёт в Telegram: [telegram_daily_report.py](telegram_daily_report.py)
- [P1][done] Скрипт запуска: [run_daily.sh](run_daily.sh)
- [P1][todo] Автоматизация через launchd (ежедневно в 09:00)

### P2 — Еженедельные отчёты
- [P2][done] Еженедельный дайджест: [weekly_digest.py](weekly_digest.py)
- [P2][done] Анализ метрик: [weekly_metrics_analysis.py](weekly_metrics_analysis.py)
- [P2][done] Отправка в Telegram: [send_weekly_telegram.py](send_weekly_telegram.py)
- [P2][done] Скрипт запуска: [run_weekly.sh](run_weekly.sh)
- [P2][todo] Автоматизация через launchd (еженедельно в понедельник 09:00)

### P3 — Дополнительные отчёты
- [P3][done] Дайджест поведения: [behavior_digest.py](behavior_digest.py)
- [P3][done] Анализ оплат заказов: [order_payment_analysis.py](order_payment_analysis.py)
- [P3][todo] Отчёт по топ/bottom менеджерам
- [P3][todo] Отчёт по трендам (улучшение/ухудшение метрик)

---

## Фаза 4: Автоматизация и деплой

### P1 — Локальная автоматизация (macOS)
- [P1][done] Launchd plist для ежедневного запуска
- [P1][done] Launchd plist для еженедельного запуска
- [P1][todo] Проверка работы launchd (логи)
- [P1][todo] Мониторинг ошибок (алерты в Telegram)

### P2 — Облачный деплой (Railway)
- [P2][done] Инструкция деплоя: [ИНСТРУКЦИЯ_деплой_Railway.md](ИНСТРУКЦИЯ_деплой_Railway.md)
- [P2][done] Быстрый старт: [RAILWAY_БЫСТРЫЙ_СТАРТ.md](RAILWAY_БЫСТРЫЙ_СТАРТ.md)
- [P2][done] Конфиг Railway: [railway.json](railway.json)
- [P2][done] Procfile для Railway: [Procfile](Procfile)
- [P2][done] Скрипт запуска: [run_railway.py](run_railway.py)
- [P2][in_progress] Деплой на Railway (тестирование)
- [P2][todo] Cron-расписание на Railway (ежедневно/еженедельно)

### P3 — Мониторинг и алерты
- [P3][todo] Логирование в файл (`export_log.txt`)
- [P3][todo] Алерты в Telegram при ошибках
- [P3][todo] Мониторинг времени выполнения скриптов
- [P3][todo] Мониторинг API rate limits RetailCRM

---

## Фаза 5: Улучшение качества данных

### P2 — Валидация и проверка
- [P2][done] Проверка данных: [check_data.py](check_data.py)
- [P2][done] Проверка заказов: [check_order_data.py](check_order_data.py)
- [P2][done] Проверка реальных данных: [check_real_data.py](check_real_data.py)
- [P2][done] Аудит Google Sheets: [sheet_audit.py](sheet_audit.py)
- [P2][todo] Автоматическая проверка целостности данных (ежедневно)

### P3 — Оптимизация
- [P3][done] Оптимизация структуры Sheets: [optimize_sheets_structure.py](optimize_sheets_structure.py)
- [P3][done] Анализ структуры Sheets: [analyze_sheets_structure.py](analyze_sheets_structure.py)
- [P3][todo] Индексация данных (для быстрого поиска)
- [P3][todo] Кэширование частых запросов к RetailCRM API

---

## Фаза 6: Интеграция с другими системами

### P2 — Telegram
- [P2][done] Получение chat_id: [telegram_get_chat_id.py](telegram_get_chat_id.py)
- [P2][done] Ежедневные отчёты в Telegram
- [P2][done] Еженедельные отчёты в Telegram
- [P2][todo] Интерактивные команды (бот для запросов)

### P3 — Другие системы
- [P3][todo] Экспорт в Notion (для просмотра планов улучшения)
- [P3][todo] Интеграция с CRM (обратная связь по советам)
- [P3][todo] API для доступа к метрикам (для дашбордов)

---

## Фаза 7: Масштабирование и улучшения

### P3 — Новые виды анализа
- [P3][done] Best practices: [best_practices_analysis.py](best_practices_analysis.py)
- [P3][todo] Анализ тональности сообщений (sentiment analysis)
- [P3][todo] Кластеризация чатов (похожие паттерны)
- [P3][todo] Предсказание конверсии (ML-модель)

### P3 — UI/дашборд
- [P3][todo] Web-дашборд для просмотра метрик (Streamlit/Dash)
- [P3][todo] Графики динамики метрик (по времени)
- [P3][todo] Сравнение менеджеров (рейтинг)
- [P3][todo] Drill-down по чатам (детальный просмотр)

---

## Документация и инструкции

### Создано:
- [P1][done] [README.md](README.md) — общая документация
- [P1][done] [ТЗ](ТЗ_выгрузка_чатов_RetailCRM.md) — полное ТЗ
- [P1][done] [Архитектура](Архитектура.md) — архитектура системы
- [P2][done] [ИНСТРУКЦИЯ_быстрый_старт.md](ИНСТРУКЦИЯ_быстрый_старт.md)
- [P2][done] [ИНСТРУКЦИЯ_настройка_системы.md](ИНСТРУКЦИЯ_настройка_системы.md)
- [P2][done] [ИНСТРУКЦИЯ_деплой_Railway.md](ИНСТРУКЦИЯ_деплой_Railway.md)
- [P2][done] [РЕЗЮМЕ_системы.md](РЕЗЮМЕ_системы.md)
- [P2][done] [ОТВЕТЫ_на_вопросы.md](ОТВЕТЫ_на_вопросы.md)

### TODO:
- [P2][todo] Диаграммы архитектуры (визуализация потока данных)
- [P3][todo] Примеры использования (use cases)
- [P3][todo] FAQ (частые вопросы)

---

## Открытые вопросы

1. **RETAILCRM_URL и API доступ:**
   - Подтвердить домен
   - Проверить ограничения IP
   - Уточнить rate limits API

2. **Модуль WhatsApp/Instagram:**
   - native / I2CRM / другое?
   - Влияет на пути API

3. **Часовой пояс:**
   - Подтвердить для корректной оценки времени реакции
   - Рабочие часы: 10:00–23:00?

4. **Частота обновления:**
   - Разовая выгрузка или регулярная?
   - Если регулярная: ежедневно/еженедельно?

5. **Период выгрузки:**
   - 2 месяца или 3 месяца?
   - 100 дней (как в [ВЫГРУЗКА_100_ДНЕЙ.sh](ВЫГРУЗКА_100_ДНЕЙ.sh))?

---

## Риски

### Высокие (нужно митигировать)
- **API rate limits RetailCRM**
  - Митигация: батч-запросы, кэширование, задержки между запросами
- **Большой объём данных (100+ дней)**
  - Митигация: батч-экспорт, оптимизация Sheets, архивация старых данных

### Средние
- **Недостоверные данные (пропущенные сообщения)**
  - Митигация: валидация данных, проверка целостности
- **Ошибки в SPIN-классификации (rule-based)**
  - Митигация: ручная проверка, AI-анализ (будущее)

### Низкие
- **Отказ Railway (облачный деплой)**
  - Митигация: fallback на локальный launchd
- **Изменения API RetailCRM**
  - Митигация: мониторинг версии API, обновление клиента

---

## Метрики успеха

### Текущие (достигнуты):
- ✅ Выгрузка 100 дней данных за 2-3 минуты
- ✅ 8 листов в Google Sheets (chats, messages, summaries, SPIN)
- ✅ Ежедневные и еженедельные отчёты
- ✅ SPIN-анализ по 4 этапам

### Целевые (TODO):
- [ ] Автоматизация через Railway (cron)
- [ ] Алерты в Telegram при ошибках
- [ ] Корреляция SPIN ↔ конверсия в заказ
- [ ] Web-дашборд для просмотра метрик

---

## Связанные файлы

- [ТЗ](ТЗ_выгрузка_чатов_RetailCRM.md) — полное ТЗ проекта
- [Архитектура](Архитектура.md) — архитектура системы
- [README.md](README.md) — общая документация
- [План_улучшения_SPIN.md](План_улучшения_SPIN.md) — рекомендации по SPIN
- [РЕЗЮМЕ_системы.md](РЕЗЮМЕ_системы.md) — краткое резюме
- [Задачи.md](../../../../Задачи.md) — канбан проекта
