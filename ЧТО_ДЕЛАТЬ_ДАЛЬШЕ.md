# –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

> –°–≤—è–∑–∞–Ω–æ: [–¢–ó](–¢–ó_–≤—ã–≥—Ä—É–∑–∫–∞_—á–∞—Ç–æ–≤_RetailCRM.md) | [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.md) | [–ë—ç–∫–ª–æ–≥](–ë—ç–∫–ª–æ–≥.md) | 

---


## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å–æ–∑–¥–∞–Ω–∞  
‚úÖ –°–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –æ–ø–ª–∞—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `export_to_sheets.py`  

---

## üéØ –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
cd "/Users/noor/Documents/Obsidian Vault/Cursor/INSTINTO/–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤/retailcrm_chats"
source .venv/bin/activate
python -c "
from sheets import open_spreadsheet
from pathlib import Path

base = Path('.')
env = {}
for line in (base / 'env').read_text().splitlines():
    if '=' in line and not line.strip().startswith('#'):
        k, v = line.split('=', 1)
        env[k.strip()] = v.strip().strip('\"').strip(\"'\")

ss = open_spreadsheet(
    spreadsheet_id=env['GOOGLE_SHEETS_ID'],
    service_account_json_path=env['GOOGLE_SERVICE_ACCOUNT_JSON'],
)

ws = ss.worksheet('chats_raw')
header = ws.get_all_values()[0] if ws.get_all_values() else []

has_order = 'has_order' in header
payment = 'payment_status' in header

print('‚úÖ –ö–æ–ª–æ–Ω–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ –µ—Å—Ç—å' if (has_order and payment) else '‚ùå –ù—É–∂–Ω–∞ –ø–µ—Ä–µ–≤—ã–≥—Ä—É–∑–∫–∞')
"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚úÖ –ö–æ–ª–æ–Ω–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ –µ—Å—Ç—å` ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –®–ê–ì 2–ê
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `‚ùå –ù—É–∂–Ω–∞ –ø–µ—Ä–µ–≤—ã–≥—Ä—É–∑–∫–∞` ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –®–ê–ì 2–ë

---

## üéØ –®–ê–ì 2–ê: –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∏ –£–ñ–ï –µ—Å—Ç—å (–æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
```bash
cd "/Users/noor/Documents/Obsidian Vault/Cursor/INSTINTO/–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤/retailcrm_chats"
source .venv/bin/activate
python update_order_payment_only.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —á–∞—Ç–æ–≤
- –ù–µ –ø–µ—Ä–µ–≤—ã–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
- –í—Ä–µ–º—è: ~15-20 –º–∏–Ω—É—Ç (3260 —á–∞—Ç–æ–≤)

---

## üéØ –®–ê–ì 2–ë: –ï—Å–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ –ù–ï–¢ (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–≤—ã–≥—Ä—É–∑–∫–∞)

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ–ª–Ω—É—é –≤—ã–≥—Ä—É–∑–∫—É:
```bash
cd "/Users/noor/Documents/Obsidian Vault/Cursor/INSTINTO/–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤/retailcrm_chats"
source .venv/bin/activate
python export_to_sheets.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –í—ã–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —á–∞—Ç—ã –∑–∞–Ω–æ–≤–æ
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ –∏ –æ–ø–ª–∞—Ç–æ–π
- –í—Ä–µ–º—è: ~20-30 –º–∏–Ω—É—Ç

---

## üéØ –®–ê–ì 3: –ó–∞–ø—É—Å—Ç–∏—Ç—å SPIN-–∞–Ω–∞–ª–∏–∑

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö:
```bash
python spin_analysis.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –ø–æ SPIN-–º–µ—Ç–æ–¥–∏–∫–µ
- –°–æ–∑–¥–∞—ë—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ Google Sheets

---

## üéØ –®–ê–ì 4: –í—ã–¥–µ–ª–∏—Ç—å —Ç–æ–ø-5 –ø—Ä–æ–±–ª–µ–º

```bash
python weekly_metrics_analysis.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –í—ã–¥–µ–ª—è–µ—Ç —Ç–æ–ø-5 –ø—Ä–æ–±–ª–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- –°–æ–∑–¥–∞—ë—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–ª–∞–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è

---

## üéØ –®–ê–ì 5: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑—å SPIN —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π

```bash
python spin_conversion_analysis.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, –∫–∞–∫–∏–µ —ç—Ç–∞–ø—ã SPIN –≤–ª–∏—è—é—Ç –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏—é
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Google Sheets

---

## üéØ –®–ê–ì 6: –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤

```bash
python dialog_templates.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —á–∞—Ç—ã
- –°–æ–∑–¥–∞—ë—Ç –≥–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

---

## üéØ –®–ê–ì 7: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 7.1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram-–±–æ—Ç

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/BotFather)
2. –ü–æ–ª—É—á–∏—Ç–µ `TELEGRAM_BOT_TOKEN`
3. –£–∑–Ω–∞–π—Ç–µ `TELEGRAM_CHAT_ID` (–Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É, –∑–∞—Ç–µ–º `https://api.telegram.org/botTOKEN/getUpdates`)
4. –î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `env`:
   ```
   TELEGRAM_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"
   TELEGRAM_CHAT_ID="–≤–∞—à_chat_id"
   ```

### 7.2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫

```bash
mkdir -p ~/Library/LaunchAgents
cp launchd/ru.instinto.retailcrm.daily.plist ~/Library/LaunchAgents/
launchctl unload ~/Library/LaunchAgents/ru.instinto.retailcrm.daily.plist 2>/dev/null || true
launchctl load ~/Library/LaunchAgents/ru.instinto.retailcrm.daily.plist
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–∞–ª–∏–∑
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç –≤ Telegram
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫

---

## üìä –ß—Ç–æ –±—É–¥–µ—Ç –≤ Google Sheets –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –õ–∏—Å—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:
- `chats_raw` ‚Äî –≤—Å–µ —á–∞—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –∑–∞–∫–∞–∑–∞—Ö –∏ –æ–ø–ª–∞—Ç–µ
- `messages_raw` ‚Äî –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `spin_manager_metrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ SPIN –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- `spin_chat_metrics` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ SPIN –ø–æ —á–∞—Ç–∞–º
- `manager_top_problems` ‚Äî —Ç–æ–ø-5 –ø—Ä–æ–±–ª–µ–º –∫–∞–∂–¥–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- `weekly_metrics_tracking` ‚Äî –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `improvement_steps_detailed` ‚Äî —à–∞–≥–∏ —É–ª—É—á—à–µ–Ω–∏—è
- `spin_conversion_correlation` ‚Äî —Å–≤—è–∑—å SPIN —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π
- `dialog_templates_full` ‚Äî —à–∞–±–ª–æ–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤

### –õ–∏—Å—Ç—ã —Å –æ—Ç—á—ë—Ç–∞–º–∏:
- `daily_report` ‚Äî –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Telegram)
- `manager_order_payment_stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º –∏ –æ–ø–ª–∞—Ç–µ

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

1. **–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–∞—Ö:**
   ```bash
   python update_order_payment_only.py
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å SPIN-–∞–Ω–∞–ª–∏–∑:**
   ```bash
   python spin_analysis.py
   ```

3. **–í—ã–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã:**
   ```bash
   python weekly_metrics_analysis.py
   ```

4. **–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Google Sheets:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏—Å—Ç—ã `manager_top_problems` –∏ `weekly_metrics_tracking`

---

## ‚ùì –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   cat daily_run.err.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `env`:**
   - `RETAILCRM_URL`
   - `RETAILCRM_API_KEY`
   - `GOOGLE_SHEETS_ID`
   - `GOOGLE_SERVICE_ACCOUNT_JSON`

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç API:**
   ```bash
   python test_order_api.py
   ```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] –î–∞–Ω–Ω—ã–µ –æ –∑–∞–∫–∞–∑–∞—Ö –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ `chats_raw`
- [ ] SPIN-–∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –¢–æ–ø-5 –ø—Ä–æ–±–ª–µ–º –≤—ã–¥–µ–ª–µ–Ω—ã
- [ ] –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–≤—è–∑—å SPIN —Å –∫–æ–Ω–≤–µ—Ä—Å–∏–µ–π –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –®–∞–±–ª–æ–Ω—ã –¥–∏–∞–ª–æ–≥–æ–≤ —Å–æ–∑–¥–∞–Ω—ã
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Telegram-–±–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

**–ù–∞—á–Ω–∏—Ç–µ —Å –®–ê–ì–ê 1 ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∫–æ–ª–æ–Ω–∫–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏!**


